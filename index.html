<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Родословное Дерево</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
       import React, { useState, useEffect } from 'react';
import { User, Users, Heart, HeartCrack, Calendar, MessageSquare, Image, Plus, Edit2, Trash2, X, Save, Lock, Eye, ChevronDown, ChevronRight, Camera } from 'lucide-react';

const FamilyTreeApp = () => {
  const [isAdmin, setIsAdmin] = useState(false);
  const [password, setPassword] = useState('');
  const [showLogin, setShowLogin] = useState(false);
  
  const [people, setPeople] = useState([]);
  const [relationships, setRelationships] = useState([]);
  const [comments, setComments] = useState([]);
  
  const [selectedPerson, setSelectedPerson] = useState(null);
  const [editingPerson, setEditingPerson] = useState(null);
  const [showAddPerson, setShowAddPerson] = useState(false);
  const [showAddRelationship, setShowAddRelationship] = useState(false);
  
  const [newComment, setNewComment] = useState('');
  const [viewMode, setViewMode] = useState('tree');
  const [expandedNodes, setExpandedNodes] = useState(new Set());

  // Загрузка данных из localStorage при монтировании
  useEffect(() => {
    const savedPeople = localStorage.getItem('familyTreePeople');
    const savedRelationships = localStorage.getItem('familyTreeRelationships');
    const savedComments = localStorage.getItem('familyTreeComments');
    
    if (savedPeople) setPeople(JSON.parse(savedPeople));
    if (savedRelationships) setRelationships(JSON.parse(savedRelationships));
    if (savedComments) setComments(JSON.parse(savedComments));
  }, []);

  // Сохранение данных в localStorage при изменении
  useEffect(() => {
    localStorage.setItem('familyTreePeople', JSON.stringify(people));
  }, [people]);

  useEffect(() => {
    localStorage.setItem('familyTreeRelationships', JSON.stringify(relationships));
  }, [relationships]);

  useEffect(() => {
    localStorage.setItem('familyTreeComments', JSON.stringify(comments));
  }, [comments]);

  const handleLogin = () => {
    if (password === 'admin123') {
      setIsAdmin(true);
      setShowLogin(false);
      setPassword('');
    } else {
      alert('Неверный пароль');
    }
  };

  const handleLogout = () => {
    setIsAdmin(false);
  };

  const addPerson = (personData) => {
    const newPerson = {
      ...personData,
      id: Date.now().toString(),
      photos: personData.mainPhoto ? [personData.mainPhoto] : []
    };
    setPeople([...people, newPerson]);
    setShowAddPerson(false);
  };

  const updatePerson = (personData) => {
    setPeople(people.map(p => p.id === personData.id ? personData : p));
    setEditingPerson(null);
    if (selectedPerson?.id === personData.id) {
      setSelectedPerson(personData);
    }
  };

  const deletePerson = (id) => {
    if (window.confirm('Вы уверены? Все связи этого человека будут удалены.')) {
      setPeople(people.filter(p => p.id !== id));
      setRelationships(relationships.filter(r => r.person1Id !== id && r.person2Id !== id && r.parentId !== id && r.childId !== id));
      setComments(comments.filter(c => c.personId !== id));
      setSelectedPerson(null);
    }
  };

  const addRelationship = (relData) => {
    const newRel = {
      ...relData,
      id: Date.now().toString()
    };
    setRelationships([...relationships, newRel]);
    setShowAddRelationship(false);
  };

  const deleteRelationship = (id) => {
    setRelationships(relationships.filter(r => r.id !== id));
  };

  const addComment = () => {
    if (!newComment.trim()) return;
    const comment = {
      id: Date.now().toString(),
      personId: selectedPerson.id,
      text: newComment,
      date: new Date().toISOString(),
      author: isAdmin ? 'Администратор' : 'Гость'
    };
    setComments([...comments, comment]);
    setNewComment('');
  };

  const deleteComment = (id) => {
    setComments(comments.filter(c => c.id !== id));
  };

  const getPersonRelationships = (personId) => {
    return relationships.filter(r => 
      r.person1Id === personId || r.person2Id === personId
    );
  };

  const getChildren = (personId) => {
    return relationships
      .filter(r => r.type === 'parent-child' && r.parentId === personId)
      .map(r => people.find(p => p.id === r.childId))
      .filter(Boolean);
  };

  const getParents = (personId) => {
    return relationships
      .filter(r => r.type === 'parent-child' && r.childId === personId)
      .map(r => people.find(p => p.id === r.parentId))
      .filter(Boolean);
  };

  const getSpouses = (personId) => {
    return relationships
      .filter(r => (r.type === 'marriage' || r.type === 'divorce') && 
                   (r.person1Id === personId || r.person2Id === personId))
      .map(r => ({
        person: people.find(p => p.id === (r.person1Id === personId ? r.person2Id : r.person1Id)),
        relationship: r
      }))
      .filter(item => item.person);
  };

  const toggleNode = (personId) => {
    const newExpanded = new Set(expandedNodes);
    if (newExpanded.has(personId)) {
      newExpanded.delete(personId);
    } else {
      newExpanded.add(personId);
    }
    setExpandedNodes(newExpanded);
  };

  const getRootPeople = () => {
    return people.filter(person => getParents(person.id).length === 0);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
      {/* Шапка */}
      <header className="bg-white shadow-md">
        <div className="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
          <div className="flex items-center gap-3">
            <Users className="w-8 h-8 text-indigo-600" />
            <h1 className="text-2xl font-bold text-gray-800">Родословное Дерево</h1>
          </div>
          <div className="flex items-center gap-4">
            <button
              onClick={() => setViewMode(viewMode === 'tree' ? 'list' : 'tree')}
              className="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200"
            >
              {viewMode === 'tree' ? 'Список' : 'Дерево'}
            </button>
            {isAdmin ? (
              <div className="flex items-center gap-2">
                <span className="text-sm text-gray-600">Администратор</span>
                <button
                  onClick={handleLogout}
                  className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600"
                >
                  Выйти
                </button>
              </div>
            ) : (
              <button
                onClick={() => setShowLogin(true)}
                className="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
              >
                <Lock className="w-4 h-4" />
                Войти как админ
              </button>
            )}
          </div>
        </div>
      </header>

      {/* Модальное окно входа */}
      {showLogin && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-6 w-96">
            <h2 className="text-xl font-bold mb-4">Вход администратора</h2>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
              placeholder="Введите пароль"
              className="w-full px-4 py-2 border rounded-lg mb-4"
            />
            <p className="text-sm text-gray-500 mb-4">Пароль по умолчанию: admin123</p>
            <div className="flex gap-2">
              <button
                onClick={handleLogin}
                className="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
              >
                Войти
              </button>
              <button
                onClick={() => setShowLogin(false)}
                className="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400"
              >
                Отмена
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Основной контент */}
      <main className="max-w-7xl mx-auto px-4 py-6">
        {isAdmin && (
          <div className="mb-6 flex gap-4">
            <button
              onClick={() => setShowAddPerson(true)}
              className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
            >
              <Plus className="w-4 h-4" />
              Добавить человека
            </button>
            <button
              onClick={() => setShowAddRelationship(true)}
              className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
            >
              <Heart className="w-4 h-4" />
              Добавить связь
            </button>
          </div>
        )}

        {viewMode === 'tree' ? (
          <TreeView
            people={people}
            getRootPeople={getRootPeople}
            getChildren={getChildren}
            expandedNodes={expandedNodes}
            toggleNode={toggleNode}
            setSelectedPerson={setSelectedPerson}
          />
        ) : (
          <ListView
            people={people}
            setSelectedPerson={setSelectedPerson}
          />
        )}
      </main>

      {/* Модальное окно добавления человека */}
      {showAddPerson && (
        <PersonForm
          onSave={addPerson}
          onClose={() => setShowAddPerson(false)}
        />
      )}

      {/* Модальное окно редактирования человека */}
      {editingPerson && (
        <PersonForm
          person={editingPerson}
          onSave={updatePerson}
          onClose={() => setEditingPerson(null)}
        />
      )}

      {/* Модальное окно добавления связи */}
      {showAddRelationship && (
        <RelationshipForm
          people={people}
          onSave={addRelationship}
          onClose={() => setShowAddRelationship(false)}
        />
      )}

      {/* Детальная страница человека */}
      {selectedPerson && (
        <PersonDetail
          person={selectedPerson}
          people={people}
          relationships={relationships}
          comments={comments.filter(c => c.personId === selectedPerson.id)}
          isAdmin={isAdmin}
          onClose={() => setSelectedPerson(null)}
          onEdit={() => {
            setEditingPerson(selectedPerson);
            setSelectedPerson(null);
          }}
          onDelete={deletePerson}
          onAddComment={addComment}
          onDeleteComment={deleteComment}
          newComment={newComment}
          setNewComment={setNewComment}
          getSpouses={getSpouses}
          getChildren={getChildren}
          getParents={getParents}
          deleteRelationship={deleteRelationship}
          setPerson={setSelectedPerson}
        />
      )}
    </div>
  );
};

// Компонент дерева
const TreeView = ({ people, getRootPeople, getChildren, expandedNodes, toggleNode, setSelectedPerson }) => {
  const TreeNode = ({ person, level = 0 }) => {
    const children = getChildren(person.id);
    const hasChildren = children.length > 0;
    const isExpanded = expandedNodes.has(person.id);

    return (
      <div className="ml-8">
        <div className="flex items-center gap-2 mb-2">
          {hasChildren && (
            <button
              onClick={() => toggleNode(person.id)}
              className="p-1 hover:bg-gray-200 rounded"
            >
              {isExpanded ? <ChevronDown className="w-4 h-4" /> : <ChevronRight className="w-4 h-4" />}
            </button>
          )}
          <PersonCard person={person} onClick={() => setSelectedPerson(person)} compact />
        </div>
        {hasChildren && isExpanded && (
          <div className="ml-6 border-l-2 border-gray-300 pl-4">
            {children.map(child => (
              <TreeNode key={child.id} person={child} level={level + 1} />
            ))}
          </div>
        )}
      </div>
    );
  };

  const roots = getRootPeople();

  if (people.length === 0) {
    return (
      <div className="text-center py-12 text-gray-500">
        <Users className="w-16 h-16 mx-auto mb-4 opacity-50" />
        <p>Дерево пусто. Добавьте первого человека.</p>
      </div>
    );
  }

  return (
    <div className="bg-white rounded-lg shadow-lg p-6">
      <h2 className="text-xl font-bold mb-4">Семейное дерево</h2>
      {roots.map(person => (
        <TreeNode key={person.id} person={person} />
      ))}
    </div>
  );
};

// Компонент списка
const ListView = ({ people, setSelectedPerson }) => {
  if (people.length === 0) {
    return (
      <div className="text-center py-12 text-gray-500">
        <Users className="w-16 h-16 mx-auto mb-4 opacity-50" />
        <p>Список пуст. Добавьте первого человека.</p>
      </div>
    );
  }

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {people.map(person => (
        <PersonCard
          key={person.id}
          person={person}
          onClick={() => setSelectedPerson(person)}
        />
      ))}
    </div>
  );
};

// Компонент карточки человека
const PersonCard = ({ person, onClick, compact = false }) => {
  return (
    <div
      onClick={onClick}
      className={`bg-white rounded-lg shadow hover:shadow-md transition-shadow cursor-pointer ${
        compact ? 'p-2' : 'p-4'
      }`}
    >
      <div className="flex items-center gap-3">
        {person.mainPhoto ? (
          <img
            src={person.mainPhoto}
            alt={`${person.firstName} ${person.lastName}`}
            className={`${compact ? 'w-10 h-10' : 'w-16 h-16'} rounded-full object-cover`}
          />
        ) : (
          <div className={`${compact ? 'w-10 h-10' : 'w-16 h-16'} rounded-full bg-indigo-100 flex items-center justify-center`}>
            <User className={`${compact ? 'w-5 h-5' : 'w-8 h-8'} text-indigo-600`} />
          </div>
        )}
        <div className="flex-1 min-w-0">
          <h3 className={`${compact ? 'text-sm' : 'text-lg'} font-semibold text-gray-800 truncate`}>
            {person.lastName} {person.firstName}
          </h3>
          {!compact && <p className="text-sm text-gray-500">{person.middleName}</p>}
          <div className="flex items-center gap-2 text-sm text-gray-600">
            <span>{person.gender === 'M' ? '♂' : '♀'}</span>
            {person.birthDate && (
              <span className="text-xs">
                {new Date(person.birthDate).getFullYear()}
                {person.deathDate && ` - ${new Date(person.deathDate).getFullYear()}`}
              </span>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

// Форма добавления/редактирования человека
const PersonForm = ({ person, onSave, onClose }) => {
  const [formData, setFormData] = useState(person || {
    firstName: '',
    lastName: '',
    middleName: '',
    gender: 'M',
    birthDate: '',
    deathDate: '',
    maritalStatus: '',
    description: '',
    mainPhoto: ''
  });

  const handlePhotoUpload = (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        setFormData({ ...formData, mainPhoto: reader.result });
      };
      reader.readAsDataURL(file);
    }
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    onSave(formData);
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto">
      <div className="bg-white rounded-lg p-6 w-full max-w-2xl m-4">
        <h2 className="text-xl font-bold mb-4">
          {person ? 'Редактировать человека' : 'Добавить человека'}
        </h2>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium mb-1">Фамилия *</label>
              <input
                type="text"
                required
                value={formData.lastName}
                onChange={(e) => setFormData({ ...formData, lastName: e.target.value })}
                className="w-full px-3 py-2 border rounded-lg"
              />
            </div>
            <div>
              <label className="block text-sm font-medium mb-1">Имя *</label>
              <input
                type="text"
                required
                value={formData.firstName}
                onChange={(e) => setFormData({ ...formData, firstName: e.target.value })}
                className="w-full px-3 py-2 border rounded-lg"
              />
            </div>
          </div>

          <div>
            <label className="block text-sm font-medium mb-1">Отчество</label>
            <input
              type="text"
              value={formData.middleName}
              onChange={(e) => setFormData({ ...formData, middleName: e.target.value })}
              className="w-full px-3 py-2 border rounded-lg"
            />
          </div>

          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium mb-1">Пол *</label>
              <select
                value={formData.gender}
                onChange={(e) => setFormData({ ...formData, gender: e.target.value })}
                className="w-full px-3 py-2 border rounded-lg"
              >
                <option value="M">Мужской</option>
                <option value="F">Женский</option>
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium mb-1">Семейный статус</label>
              <select
                value={formData.maritalStatus}
                onChange={(e) => setFormData({ ...formData, maritalStatus: e.target.value })}
                className="w-full px-3 py-2 border rounded-lg"
              >
                <option value="">Не указан</option>
                <option value="married">В браке</option>
                <option value="divorced">Разведён(а)</option>
                <option value="single">Не женат/не замужем</option>
              </select>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium mb-1">Дата рождения</label>
              <input
                type="date"
                value={formData.birthDate}
                onChange={(e) => setFormData({ ...formData, birthDate: e.target.value })}
                className="w-full px-3 py-2 border rounded-lg"
              />
            </div>
            <div>
              <label className="block text-sm font-medium mb-1">Дата смерти</label>
              <input
                type="date"
                value={formData.deathDate}
                onChange={(e) => setFormData({ ...formData, deathDate: e.target.value })}
                className="w-full px-3 py-2 border rounded-lg"
              />
            </div>
          </div>

          <div>
            <label className="block text-sm font-medium mb-1">Описание</label>
            <textarea
              value={formData.description}
              onChange={(e) => setFormData({ ...formData, description: e.target.value })}
              rows={3}
              className="w-full px-3 py-2 border rounded-lg"
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-1">Главная фотография</label>
            <input
              type="file"
              accept="image/*"
              onChange={handlePhotoUpload}
              className="w-full px-3 py-2 border rounded-lg"
            />
            {formData.mainPhoto && (
              <img src={formData.mainPhoto} alt="Preview" className="mt-2 w-32 h-32 object-cover rounded" />
            )}
          </div>

          <div className="flex gap-2">
            <button
              type="submit"
              className="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
            >
              Сохранить
            </button>
            <button
              type="button"
              onClick={onClose}
              className="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400"
            >
              Отмена
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

// Форма добавления связи
const RelationshipForm = ({ people, onSave, onClose }) => {
  const [formData, setFormData] = useState({
    type: 'marriage',
    person1Id: '',
    person2Id: '',
    parentId: '',
    childId: '',
    marriageDate: '',
    divorceDate: ''
  });

  const handleSubmit = (e) => {
    e.preventDefault();
    onSave(formData);
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg p-6 w-full max-w-md">
        <h2 className="text-xl font-bold mb-4">Добавить связь</h2>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium mb-1">Тип связи</label>
            <select
              value={formData.type}
              onChange={(e) => setFormData({ ...formData, type: e.target.value })}
              className="w-full px-3 py-2 border rounded-lg"
            >
              <option value="marriage">Брак</option>
              <option value="divorce">Развод</option>
              <option value="parent-child">Родитель-ребёнок</option>
            </select>
          </div>

          {(formData.type === 'marriage' || formData.type === 'divorce') && (
            <>
              <div>
                <label className="block text-sm font-medium mb-1">Первый человек</label>
                <select
                  value={formData.person1Id}
                  onChange={(e) => setFormData({ ...formData, person1Id: e.target.value })}
                  required
                  className="w-full px-3 py-2 border rounded-lg"
                >
                  <option value="">Выберите...</option>
                  {people.map(p => (
                    <option key={p.id} value={p.id}>
                      {p.lastName} {p.firstName}
                    </option>
                  ))}
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Второй человек</label>
                <select
                  value={formData.person2Id}
                  onChange={(e) => setFormData({ ...formData, person2Id: e.target.value })}
                  required
                  className="w-full px-3 py-2 border rounded-lg"
                >
                  <option value="">Выберите...</option>
                  {people.map(p => (
                    <option key={p.id} value={p.id}>
                      {p.lastName} {p.firstName}
                    </option>
                  ))}
                </select>
              </div>
              {formData.type === 'marriage' && (
                <div>
                  <label className="block text-sm font-medium mb-1">Дата брака</label>
                  <input
                    type="date"
                    value={formData.marriageDate}
                    onChange={(e) => setFormData({ ...formData, marriageDate: e.target.value })}
                    className="w-full px-3 py-2 border rounded-lg"
                  />
                </div>
              )}
              {formData.type === 'divorce' && (
                <div>
                  <label className="block text-sm font-medium mb-1">Дата развода</label>
                  <input
                    type="date"
                    value={formData.divorceDate}
                    onChange={(e) => setFormData({ ...formData, divorceDate: e.target.value })}
                    className="w-full px-3 py-2 border rounded-lg"
                  />
                </div>
              )}
            </>
          )}

          {formData.type === 'parent-child' && (
            <>
              <div>
                <label className="block text-sm font-medium mb-1">Родитель</label>
                <select
                  value={formData.parentId}
                  onChange={(e) => setFormData({ ...formData, parentId: e.target.value })}
                  required
                  className="w-full px-3 py-2 border rounded-lg"
                >
                  <option value="">Выберите...</option>
                  {people.map(p => (
                    <option key={p.id} value={p.id}>
                      {p.lastName} {p.firstName}
                    </option>
                  ))}
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Ребёнок</label>
                <select
                  value={formData.childId}
                  onChange={(e) => setFormData({ ...formData, childId: e.target.value })}
                  required
                  className="w-full px-3 py-2 border rounded-lg"
                >
                  <option value="">Выберите...</option>
                  {people.map(p => (
                    <option key={p.id} value={p.id}>
                      {p.lastName} {p.firstName}
                    </option>
                  ))}
                </select>
              </div>
            </>
          )}

          <div className="flex gap-2">
            <button
              type="submit"
              className="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
            >
              Добавить
            </button>
            <button
              type="button"
              onClick={onClose}
              className="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400"
            >
              Отмена
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

// Детальная страница человека
const PersonDetail = ({
  person,
  people,
  relationships,
  comments,
  isAdmin,
  onClose,
  onEdit,
  onDelete,
  onAddComment,
  onDeleteComment,
  newComment,
  setNewComment,
  getSpouses,
  getChildren,
  getParents,
  deleteRelationship,
  setPerson
}) => {
  const [showPhotoGallery, setShowPhotoGallery] = useState(false);
  const [selectedPhotoIndex, setSelectedPhotoIndex] = useState(0);

  const spouses = getSpouses(person.id);
  const children = getChildren(person.id);
  const parents = getParents(person.id);

  const handleAddPhoto = (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        const updatedPerson = {
          ...person,
          photos: [...(person.photos || []), reader.result]
        };
        setPerson(updatedPerson);
      };
      reader.readAsDataURL(file);
    }
  };

  const handleDeletePhoto = (index) => {
    const updatedPerson = {
      ...person,
      photos: person.photos.filter((_, i) => i !== index)
    };
    setPerson(updatedPerson);
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto">
      <div className="bg-white rounded-lg w-full max-w-4xl m-4 max-h-[90vh] overflow-y-auto">
        {/* Заголовок */}
        <div className="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
          <h2 className="text-2xl font-bold">
            {person.lastName} {person.firstName} {person.middleName}
          </h2>
          <div className="flex items-center gap-2">
            {isAdmin && (
              <>
                <button
                  onClick={onEdit}
                  className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg"
                >
                  <Edit2 className="w-5 h-5" />
                </button>
                <button
                  onClick={() => onDelete(person.id)}
                  className="p-2 text-red-600 hover:bg-red-50 rounded-lg"
                >
                  <Trash2 className="w-5 h-5" />
                </button>
              </>
            )}
            <button
              onClick={onClose}
              className="p-2 hover:bg-gray-100 rounded-lg"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>

        <div className="p-6 space-y-6">
          {/* Основная информация */}
          <div className="flex gap-6">
            <div className="flex-shrink-0">
              {person.mainPhoto ? (
                <img
                  src={person.mainPhoto}
                  alt={`${person.firstName} ${person.lastName}`}
                  className="w-32 h-32 rounded-lg object-cover"
                />
              ) : (
                <div className="w-32 h-32 rounded-lg bg-indigo-100 flex items-center justify-center">
                  <User className="w-16 h-16 text-indigo-600" />
                </div>
              )}
            </div>
            <div className="flex-1 space-y-2">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <p className="text-sm text-gray-500">Пол</p>
                  <p className="font-medium">{person.gender === 'M' ? 'Мужской' : 'Женский'}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-500">Семейный статус</p>
                  <p className="font-medium">
                    {person.maritalStatus === 'married' ? 'В браке' :
                     person.maritalStatus === 'divorced' ? 'Разведён(а)' :
                     person.maritalStatus === 'single' ? 'Не женат/не замужем' : 'Не указан'}
                  </p>
                </div>
                <div>
                  <p className="text-sm text-gray-500">Дата рождения</p>
                  <p className="font-medium">
                    {person.birthDate ? new Date(person.birthDate).toLocaleDateString('ru-RU') : '—'}
                  </p>
                </div>
                <div>
                  <p className="text-sm text-gray-500">Дата смерти</p>
                  <p className="font-medium">
                    {person.deathDate ? new Date(person.deathDate).toLocaleDateString('ru-RU') : '—'}
                  </p>
                </div>
              </div>
              {person.description && (
                <div>
                  <p className="text-sm text-gray-500">Описание</p>
                  <p className="text-gray-700">{person.description}</p>
                </div>
              )}
            </div>
          </div>

          {/* Семейные связи */}
          <div className="border-t pt-4">
            <h3 className="text-lg font-semibold mb-3">Семейные связи</h3>
            
            {parents.length > 0 && (
              <div className="mb-4">
                <p className="text-sm font-medium text-gray-700 mb-2">Родители:</p>
                <div className="flex flex-wrap gap-2">
                  {parents.map(parent => (
                    <span key={parent.id} className="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">
                      {parent.lastName} {parent.firstName}
                    </span>
                  ))}
                </div>
              </div>
            )}

            {spouses.length > 0 && (
              <div className="mb-4">
                <p className="text-sm font-medium text-gray-700 mb-2">Супруги:</p>
                <div className="space-y-2">
                  {spouses.map(({ person: spouse, relationship }) => (
                    <div key={spouse.id} className="flex items-center justify-between bg-pink-50 p-3 rounded-lg">
                      <div className="flex items-center gap-2">
                        {relationship.type === 'marriage' ? (
                          <Heart className="w-4 h-4 text-pink-600" />
                        ) : (
                          <HeartCrack className="w-4 h-4 text-gray-600" />
                        )}
                        <span className="font-medium">
                          {spouse.lastName} {spouse.firstName}
                        </span>
                        <span className="text-sm text-gray-600">
                          {relationship.type === 'marriage' ? '(В браке)' : '(Развод)'}
                        </span>
                        {relationship.marriageDate && (
                          <span className="text-xs text-gray-500">
                            с {new Date(relationship.marriageDate).toLocaleDateString('ru-RU')}
                          </span>
                        )}
                        {relationship.divorceDate && (
                          <span className="text-xs text-gray-500">
                            до {new Date(relationship.divorceDate).toLocaleDateString('ru-RU')}
                          </span>
                        )}
                      </div>
                      {isAdmin && (
                        <button
                          onClick={() => deleteRelationship(relationship.id)}
                          className="p-1 text-red-600 hover:bg-red-50 rounded"
                        >
                          <Trash2 className="w-4 h-4" />
                        </button>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            )}

            {children.length > 0 && (
              <div>
                <p className="text-sm font-medium text-gray-700 mb-2">Дети:</p>
                <div className="flex flex-wrap gap-2">
                  {children.map(child => (
                    <span key={child.id} className="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">
                      {child.lastName} {child.firstName}
                    </span>
                  ))}
                </div>
              </div>
            )}

            {parents.length === 0 && spouses.length === 0 && children.length === 0 && (
              <p className="text-gray-500 text-sm">Нет семейных связей</p>
            )}
          </div>

          {/* Фотоальбом */}
          <div className="border-t pt-4">
            <div className="flex items-center justify-between mb-3">
              <h3 className="text-lg font-semibold">Фотоальбом</h3>
              {isAdmin && (
                <label className="flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 cursor-pointer">
                  <Camera className="w-4 h-4" />
                  <span className="text-sm">Добавить фото</span>
                  <input
                    type="file"
                    accept="image/*"
                    onChange={handleAddPhoto}
                    className="hidden"
                  />
                </label>
              )}
            </div>
            {person.photos && person.photos.length > 0 ? (
              <div className="grid grid-cols-4 gap-2">
                {person.photos.map((photo, index) => (
                  <div key={index} className="relative group">
                    <img
                      src={photo}
                      alt={`Фото ${index + 1}`}
                      onClick={() => {
                        setSelectedPhotoIndex(index);
                        setShowPhotoGallery(true);
                      }}
                      className="w-full h-24 object-cover rounded cursor-pointer hover:opacity-75 transition"
                    />
                    {isAdmin && (
                      <button
                        onClick={() => handleDeletePhoto(index)}
                        className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded opacity-0 group-hover:opacity-100 transition"
                      >
                        <X className="w-3 h-3" />
                      </button>
                    )}
                  </div>
                ))}
              </div>
            ) : (
              <p className="text-gray-500 text-sm">Нет фотографий</p>
            )}
          </div>

          {/* Комментарии */}
          <div className="border-t pt-4">
            <h3 className="text-lg font-semibold mb-3">Комментарии</h3>
            
            {/* Форма добавления комментария */}
            <div className="mb-4">
              <textarea
                value={newComment}
                onChange={(e) => setNewComment(e.target.value)}
                placeholder="Напишите комментарий..."
                rows={3}
                className="w-full px-3 py-2 border rounded-lg resize-none"
              />
              <button
                onClick={onAddComment}
                className="mt-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
              >
                Добавить комментарий
              </button>
            </div>

            {/* Список комментариев */}
            <div className="space-y-3">
              {comments.length > 0 ? (
                comments.map(comment => (
                  <div key={comment.id} className="bg-gray-50 p-4 rounded-lg">
                    <div className="flex justify-between items-start mb-2">
                      <div>
                        <p className="font-medium text-sm">{comment.author}</p>
                        <p className="text-xs text-gray-500">
                          {new Date(comment.date).toLocaleString('ru-RU')}
                        </p>
                      </div>
                      {isAdmin && (
                        <button
                          onClick={() => onDeleteComment(comment.id)}
                          className="p-1 text-red-600 hover:bg-red-50 rounded"
                        >
                          <Trash2 className="w-4 h-4" />
                        </button>
                      )}
                    </div>
                    <p className="text-gray-700">{comment.text}</p>
                  </div>
                ))
              ) : (
                <p className="text-gray-500 text-sm">Нет комментариев</p>
              )}
            </div>
          </div>
        </div>
      </div>

      {/* Галерея фотографий */}
      {showPhotoGallery && person.photos && person.photos.length > 0 && (
        <div className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50">
          <button
            onClick={() => setShowPhotoGallery(false)}
            className="absolute top-4 right-4 p-2 text-white hover:bg-gray-800 rounded-lg"
          >
            <X className="w-6 h-6" />
          </button>
          <button
            onClick={() => setSelectedPhotoIndex((selectedPhotoIndex - 1 + person.photos.length) % person.photos.length)}
            className="absolute left-4 p-2 text-white hover:bg-gray-800 rounded-lg"
          >
            ←
          </button>
          <img
            src={person.photos[selectedPhotoIndex]}
            alt={`Фото ${selectedPhotoIndex + 1}`}
            className="max-w-[90%] max-h-[90%] object-contain"
          />
          <button
            onClick={() => setSelectedPhotoIndex((selectedPhotoIndex + 1) % person.photos.length)}
            className="absolute right-4 p-2 text-white hover:bg-gray-800 rounded-lg"
          >
            →
          </button>
          <div className="absolute bottom-4 text-white">
            {selectedPhotoIndex + 1} / {person.photos.length}
          </div>
        </div>
      )}
    </div>
  );
};

export default FamilyTreeApp;
    </script>
</body>
</html>
